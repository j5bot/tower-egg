(function(b){"function"===typeof define&&define.amd?define(["jquery","jquery-ui"],b):b(jQuery)})(function(b){b.tower=b.fn.tower=function(e,z){var a=this;e.source&&(a=b(e.source).children());0===b("#tower-stylesheet").size()&&b('<style id="tower-stylesheet" />').html(".tower-container{position:relative;width:800px;height:280px;background-color:white;border:#3d9952 solid 3px;font-family:Helvetica,Arial,sans-serif;border-radius:20px;z-index:20;user-select:none;-webkit-user-select:none;}.tower-banner{display:none;position:absolute;top:50px;left:200px;height:100px;width:400px;font-size:12px;background-color:#3d9952;color:white;text-align:center;padding:20px;border-radius:20px;border:solid 1px #c6f1a2;z-index:24;}.tower-banner h1{font-size:30px;}.tower-peg{display:inline-block;position:relative;margin:0;padding:0;margin-left:10px;width:250px;height:280px;background-image:-webkit-linear-gradient(left,transparent 52px,#53c66d 52px,#c6f1a2 72px,#53c66d 84px,transparent 88px);background-image:linear-gradient(left,transparent 52px,#53c66d 52px,#c6f1a2 72px,#53c66d 84px,transparent 88px);}.tower-peg-top{height:30px;width:60px;position:absolute;top:0;left:50px;background-color:white;background-image:-webkit-radial-gradient(20px bottom,20px 13px,#c6f1a2 0,#53c66d 88%,rgba(0,0,0,0) 88%);background-image:radial-gradient(20px 13px at 20px bottom,#c6f1a2 0,#53c66d 88%,rgba(0,0,0,0) 88%);}.tower-discs{list-style-type:none;margin:0;padding:0;position:absolute;bottom:0;width:230px;text-align:center;z-index:23;cursor:hand;}.tower-disc{display:block;color:white;font-size:15px;line-height:25px;font-weight:bold;text-shadow:-1px -1px rgba(0,0,0,0.3);background-color:#4bd321;background-image:-webkit-linear-gradient(top,#c6f1a2 22%,#3d9952 88%);background-image:-moz-linear-gradient(top,#c6f1a2 22%,#3d9952 88%);background-image:-ms-linear-gradient(top,#c6f1a2 22%,#3d9952 88%);background-image:-o-linear-gradient(top,#c6f1a2 22%,#3d9952 88%);background-image:linear-gradient(to bottom,#c6f1a2 22%,#3d9952 88%);border:solid 1px #3d9952;border-radius:15px;margin:10px;height:25px;}").appendTo("head");
var h=b(e.container?e.container:e),q=0,c=e.min||3,f=a.size(),t,h=b('<div class="tower-container" />').append('<div class="tower-peg"><ul class="tower-discs" /><div class="tower-peg-top" /></div>').append('<div class="tower-peg"><ul class="tower-discs" /><div class="tower-peg-top" /></div>').append('<div class="tower-peg"><ul class="tower-discs" /><div class="tower-peg-top" /></div>').append('<div class="tower-banner"><h1>CONGRATULATIONS!</h1><p>Completed in <span class="tower-moves">0</span> moves (your score: <span class="tower-score">0</span>%)</p></div>').appendTo(h),
m=b(".tower-peg",h),A=b(".tower-discs",m).first(),r,u;if(f<c){for(;f<c;f++)a=a.add("<span>"+(f+1)+"</span>");f=a.size()}h.add(m).css({height:45*(f+1)+"px"});t=Math.pow(2,f)-1;u=Math.floor(120/f);a.each(function(a){var d=b(this).text();if(!d||0===d.length)d=(a+1).toString();b('<li class="tower-disc" data-tower-disc-size="'+(a+1)+'">'+d+"</li>").css({width:110+a*u+"px"}).appendTo(A)});r=b(".tower-disc");m.last().addClass("winner");m.droppable({accept:function(a){var d=b(".tower-disc:first",this).attr("data-tower-disc-size");
a=parseInt(a.attr("data-tower-disc-size"),0);return isNaN(d)||parseInt(d,10)>a?!0:!1},drop:function(a,d){var n=b(this),c;d.draggable.css({top:"",left:""}).prependTo(b(".tower-discs",this)).draggable("option","revert",!1);q++;n.hasClass("winner")&&(c=b(".tower-disc",n.parent()).size(),n=b(".tower-disc",n).size(),n===c&&(b(".tower-moves").text(q),b(".tower-score").text(Math.floor(100*(q/t))),b(".tower-banner").show(),r.draggable("disable")))},tolerance:"intersect",scope:"tower"});r.draggable({cancel:".tower-discs .tower-disc:gt(0)",
containment:".tower-container",cursor:"hand",scope:"tower",zIndex:3E3,start:function(){b(this).draggable("option","revert",!0)}});if(z){for(var a=b(e.container?e.container:e),y=function(){if(b(".tower-disc",v).size()==s)console.log(p+" / "+w);else{p++;var a,d,c=k.offset();a=j.eq(k.parent().parent().data(x?"leftPeg":"rightPeg"));d=a.offset();d.left=d.left-c.left+k.position().left;k.animate({top:"-100px",left:d.left+"px"},{duration:1E3,complete:B(k,a)})}},B=function(a,d){return function(){a.css({top:"",
left:""}).prependTo(b(".tower-discs",d));if(b(".tower-disc",v).size()==s)console.log(p+" / "+w);else{p++;var c,e,g,f,l=[];j.each(function(){var a=b(".tower-disc:first",this);0<a.size()?l.push(parseInt(a.attr("data-tower-disc-size"),10)):l.push(Infinity)});g=0;for(var k=l.length;g<k;g++)for(var h=0,m=l.length;h<m;h++)if(1<l[g]&&l[g]<l[h]){c=b(".tower-disc:first",j.eq(g));f=c.offset();e=j.eq(h);break}g=e.offset();g.left=g.left-f.left+c.position().left;c.animate({top:"-100px",left:g.left+"px"},{duration:1E3,
complete:C(c,e)})}}},C=function(a,c){return function(){a.css({top:"",left:""}).prependTo(b(".tower-discs",c));y()}},p=0,c=b(".tower-disc",a),j=b(".tower-peg",a),v=j.last(),k=c.first(),s=c.size(),w=Math.pow(2,s)-1,x=0<c.size()%2,a=0,c=j.size();a<c;a++)x?j.eq(a).data("leftPeg",0===a?c-1:a-1):j.eq(a).data("rightPeg",a===c-1?0:a+1);y()}return this}});